<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.UsersMapper">

    <select id="getUserByNickname" resultType="Users">
        SELECT * FROM users WHERE nickname = #{nickname}
    </select>

    <insert id="insertUsers"  parameterType="Users" >
        INSERT INTO users(id, nickname, userType, name, password, birthdate, gender, address,
                             phone, email, consent1, consent2, isDeleted, createdAt, updatedAt)
        VALUES(users_id_seq.nextval, #{nickname}, #{userType}, #{name}, #{password}, #{birthdate}, #{gender},#{address},
               #{phone}, #{email}, #{consent1}, #{consent2}, '0', sysdate, null)
    </insert>

    <select id="getUserList" resultType="Users">
    </select>

    <select id="totalUsers" resultType="int" parameterType="Users">
        SELECT count(*)
        FROM users
        WHERE
        <if test="keyword != null and keyword != ''">
            <choose>
                <!-- "searchType"이 "nickname"일 때 -->
                <when test="searchType == 'nickname'">
                    AND name like '%' || #{keyword}|| '%'
                </when>
                <!-- "searchType"이 "phone"일 때 -->
                <when test="searchType == 'phone'">
                    AND email like '%' || #{keyword}|| '%'
                </when>
                <!-- "searchType"이 "name"일 때 -->
                <when test="searchType == 'name'">
                    AND nickname like '%' || #{keyword}|| '%'
                </when>
            </choose>
        </if>

        <if test="email != null and email != ''">
            AND email = #{email}
        </if>

        <if test="nickname != null and nickname != ''">
            AND nickname = #{nickname}
        </if>

        <!-- "startDate"와 "endDate"로 가입일을 조회 -->
        <if test="startDate != null and endDate != null">
            AND createdAt BETWEEN #{startDate} AND #{endDate}
        </if>

    </select>


    <select id="usersNicknameCheck" parameterType="Users" resultType="int">
        select count(*)
        from users
        where nickname = #{nickname}
    </select>

    <select id="idSearchByPhone" parameterType="Users" resultType="Users">
        select nickname
        from users
        where name = #{name}
        and phone = #{phone}
    </select>

</mapper>