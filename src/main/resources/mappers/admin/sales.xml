<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.paymentsMapper">
    <select id="listSales" resultType="Payments">
        SELECT *
        FROM   payments

    </select>
    <select id="listSalesCount" resultType="int">
        SELECT count(*)
        FROM   payments
    </select>
    <select id="saleSearchList" resultType="Payments">

        SELECT *
        FROM   payments
    <choose>
        <when test="status == 1">
            <if test="searchType == 'user'">
                WHERE userId =
                (
                SELECT id
                FROM users
                WHERE name like '%'|| #{keyword} || '%'
                )
                AND purchaseDate BETWEEN #{keywordDate1} and #{keywordDate2}

            </if>
            <if test="searchType == 'content'">
                WHERE contentId =
                (
                SELECT id
                FROM   gamecontents
                WHERE  title like '%'|| #{keyword} || '%'
                )
                AND purchaseDate BETWEEN #{keywordDate1} and #{keywordDate2}

            </if>
        </when>
        <when test="status == 2">
            <if test="searchType == 'user'">
                WHERE userId =
                (
                SELECT id
                FROM users
                WHERE name like '%'|| #{keyword} || '%'
                )
            </if>
            <if test="searchType == 'content'">
                WHERE contentId =
                (
                SELECT id
                FROM   gamecontents
                WHERE  title like '%'|| #{keyword} || '%'
                )
            </if>
        </when>

        <when test="status == 4">
            <if test="searchType == 'user'">
                WHERE userId =
                (
                SELECT id
                FROM users
                WHERE name like '%'|| #{keyword} || '%'
                )
                AND purchaseDate <![CDATA[ >= ]]> #{keywordDate1}
            </if>
            <if test="searchType == 'content'">
                WHERE contentId =
                (
                SELECT id
                FROM   gamecontents
                WHERE  title like '%'|| #{keyword} || '%'
                )
                AND purchaseDate <![CDATA[ >= ]]> #{keywordDate1}
            </if>
        </when>
        <when test="status == 5">
            <if test="searchType == 'user'">
                WHERE userId =
                (
                SELECT id
                FROM users
                WHERE name like '%'|| #{keyword} || '%'
                )
                AND purchaseDate <![CDATA[ <= ]]> #{keywordDate2}
            </if>
            <if test="searchType == 'content'">
                WHERE contentId =
                (
                SELECT id
                FROM   gamecontents
                WHERE  title like '%'|| #{keyword} || '%'
                )
                AND purchaseDate <![CDATA[ <= ]]> #{keywordDate2}
            </if>
        </when>


    </choose>
    </select>
</mapper>