<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.EducationalResourcesMapper">

    <insert id="educationUpload" parameterType="EducationalResources">
        INSERT INTO EducationalResources
        VALUES (EDUCATIONALRESOURCES_ID_SEQ.NEXTVAL, #{contentId}, #{userId}, #{title},
                #{resourceType}, #{fileType}, #{fileAddress}, #{serviceType}, #{content},
                #{image}, 0, sysdate, null)
    </insert>
    <select id="listEdu" parameterType="Users" resultType="EducationalResources">
        <choose>
            <when test="userType != 1">
                SELECT e.id, e.contentId, e.userId, e.title, e.resourceType, e.fileType, e.fileAddress, e.serviceType, e.content, e.image, e.readCount, e.createdAt, e.updatedAt, g.title as gameTitle
                FROM   EducationalResources e
                JOIN   GameContents g ON e.contentId = g.id
                WHERE  e.servicetype = 1
                <if test="id != 0">
                    UNION
                    SELECT e.id, e.contentId, e.userId, e.title, e.resourceType, e.fileType, e.fileAddress, e.serviceType, e.content, e.image, e.readCount, e.createdAt, e.updatedAt, g.title as gameTitle
                    FROM   learningGroup l
                    JOIN   EducationalResources e ON l.contentId = e.contentId
                    JOIN   users u ON u.id = l.userId
                    JOIN   GameContents g ON e.contentId = g.id
                    WHERE u.id = #{id}
                    AND   e.serviceType = 2
                </if>
            </when>
            <otherwise>
                SELECT e.id, e.contentId, e.userId, e.title, e.resourceType, e.fileType, e.fileAddress, e.serviceType, e.content, e.image, e.readCount, e.createdAt, e.updatedAt, g.title as gameTitle
                FROM   EducationalResources e, GameContents g
                WHERE  e.contentId = g.id
                ORDER by e.id desc
            </otherwise>
        </choose>
    </select>

    <select id="detailEdu" parameterType="int" resultType="EducationalResources">
        SELECT *
        FROM   EducationalResources
        WHERE  id = #{id}
    </select>

    <update id="readCnt" parameterType="int">
        UPDATE EducationalResources SET readcount = readcount+1 WHERE id = #{id}
    </update>

    <delete id="deleteEdu" parameterType="int">
        DELETE EducationalResources WHERE id = #{id}
    </delete>

    <update id="updateEdu" parameterType="EducationalResources">
        UPDATE EducationalResources
        SET contentId = #{contentId}, userId = #{userId},
            image = #{image}, createdAt = #{createdAt}, title = #{title},
            resourceType = #{resourceType}, fileType = #{fileType},
            fileAddress = #{fileAddress}, serviceType = #{serviceType},
            content = #{content}
        WHERE id = #{id}
    </update>

</mapper>