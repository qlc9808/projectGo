<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.PaymentsMapper">

    <!-- 결제하기 클릭 후 payments 테이블에 insert -->
    <insert id="subscribePayInsert" parameterType="Payments">
        insert into paymetns (id,                       userid, contentid, paymenttype, status, purchasedate)
                      values (PAYMENTS_ID_SEQ.nextval, #{userId}, #{contentid}, #{paymenttype}, 1, sysdate)
    </insert>


    <!-- 내가 구독한 게임 컨텐츠 리스트 총 갯수 -->
    <select id="subscribeUserPayTotalCount" parameterType="int" resultType="int">
        select count(*)
        from   payments
        where  userid = #{userid}
    </select>


    <!-- 내가 구독한 게임 컨텐츠 리스트 조회 -->
    <select id="mySubscribePayList" parameterType="Payments" resultType="Payments">
        <![CDATA[
            select *
            from
                (
                    select rownum rn, a.*
                    from (
                            select      g.* , p.*, l.name
                            from        gamecontents g, learninggroup l, payments p
                            where       g.id = l.id
                            and         g.id = p.id
                            and         p.status = 1
                            and         p.userid = #{userid}
                            order by    purchasedate desc
                         ) a
                )
              where  rn >= #{start}
              and    rn <= #{end}
        ]]>
    </select>

</mapper>