<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.PaymentsMapper">

    <!-- 결제하기 클릭 후 payments 테이블에 insert -->
    <insert id="subscribePayInsert" parameterType="payments">
        insert into payments (id,                       userId, contentId, paymentType, status, purchaseDate)
                      values (PAYMENTS_ID_SEQ.nextval, #{userId}, #{contentId}, #{paymentType}, 1, sysdate)
    </insert>

    <!-- 참고 -->
<!--    <insert id="insertDistributedHomeworksByBulk" parameterType="java.util.List">-->
<!--        <foreach collection="list" item="item" open="" close="" separator=";">-->
<!--            MERGE INTO DistributedHomeworks USING dual ON (homeworkId = #{item.homeworkId} AND userId = #{item.userId})-->
<!--            WHEN NOT MATCHED THEN-->
<!--            INSERT (homeworkId, userId, progress, createdAt)-->
<!--            VALUES (#{item.homeworkId}, #{item.userId}, #{item.progress}, SYSDATE)-->
<!--        </foreach>-->
<!--    </insert>-->


    <!-- 내가 구독한 게임 컨텐츠 리스트 총 갯수 -->
    <select id="subscribeUserPayTotalCount" parameterType="int" resultType="int">
        select count(*)
        from   payments
        where  userid = #{userid}
    </select>


    <!-- 내가 구독한 게임 컨텐츠 리스트 조회 -->
    <select id="mySubscribePayList" parameterType="payments" resultType="payments">

            select *
            from
                (
                    select rownum rn, a.*
                    from (
                            select      g.id ,g.discountPrice, g.subscribeDate,p.purchaseDate
                            from        gamecontents g, payments p

                            where        g.id = p.contentId
                            and         p.status = 1
                            and         p.userId = #{userId}
                            order by    purchaseDate desc
                         ) a
                )
              where  rn between #{start} and #{end}

    </select>



</mapper>