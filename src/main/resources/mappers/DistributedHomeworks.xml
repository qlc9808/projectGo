<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.DistributedHomeworksMapper">
    <insert id="insertDistributedHomeworksByBulk" parameterType="java.util.List">
        INSERT ALL
        <foreach collection="list" item="item">
            INTO DistributedHomeworks (homeworkId, userId, progress, createdAt)
            VALUES ( #{item.homeworkId}, #{item.userId},#{item.progress},sysdate)
        </foreach>
        SELECT * FROM dual
    </insert>
    <select id="getDistributedHomeworks" parameterType="DistributedHomeworks" resultType="DistributedHomeworks">
        SELECT
            D.*,
            U.name AS userName
        FROM
            DistributedHomeworks D
        LEFT JOIN
            users U ON D.userId = U.id
        WHERE 1=1
        <if test="homeworkId != null and homeworkId != '' and homeworkId != 0  ">
            AND homeworkId = #{homeworkId}
        </if>
        <if test="userId != null and userId != '' and userId != 0  ">
            AND userId = #{userId}
        </if>
    </select>

<!--    <update id="updateDistributedHomeworks" parameterType="java.util.List" >
        <foreach collection="list" item="item" separator=";">
            UPDATE homework
            SET evaluation = #{item.evaluation}
            WHERE homeworkId = #{item.homeworkId} AND userId = #{item.userId}
        </foreach>
    </update>-->

<!--    <update id="updateDistributedHomeworks" parameterType="java.util.List">
        <foreach collection="list" item="item" index="index" open="" close="" separator=";">
            update distributedHomeworks
            <set>
                evaluation = #{item.evaluation}
            </set>
            WHERE homeworkId = #{item.homeworkId} AND userId = #{item.userId}
        </foreach>
    </update>-->

<!--    <update id="updateDistributedHomeworks" parameterType="java.util.List">
        <foreach collection="list" item="item" index="index" open="DECLARE BEGIN" close="END;" separator=";">
            update distributedHomeworks
            <set>
                evaluation = #{item.evaluation}
            </set>
            WHERE homeworkId = #{item.homeworkId} AND userId = #{item.userId}
        </foreach>
    </update>-->
    <update id="updateDistributedHomeworks" parameterType="java.util.List">
        BEGIN
        <foreach collection="list" item="item" index="index" open="" close="" separator="">
            UPDATE distributedHomeworks
            <set>
                evaluation = #{item.evaluation}
            </set>
            WHERE homeworkId = #{item.homeworkId} AND userId = #{item.userId};
        </foreach>
        END;
    </update>


</mapper>