<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.projectGo.BoardMapper">

    <select id="boardCount" resultType="int">
        select count(*)
        from board a, users b
        where a.userId = b.id
        and a.commentIndent = 0
        <if test="keyword != null and keyword != ''">
            and a.title like '%' || #{keyword} || '%'
        </if>
        <if test="userId != null and userId != ''">
            and a.userId = #{userId}
        </if>
    </select>

    <select id="noticeboardCount" resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        WHERE boardType = 1
    </select>

    <select id="listNoticeBoard" resultType="Board">
        SELECT *
        FROM (
            SELECT ROWNUM RN, C.*
            FROM (
                SELECT A.*
                FROM BOARD A
                WHERE A.boardType = 1
                AND   sysdate >= A.createdAt
                ORDER BY A.isPinned DESC, A.id DESC
            ) C
        )
        where rn between #{start} and #{end}
    </select>

    <insert id="InsertnoticeBoard" parameterType="Board">
        INSERT INTO Board(id, userId, boardType, title, content, status, readCount, fileName, fileSize, filePath, createdAt, isPinned)
        VALUES(Board_id_seq.nextval, #{userId}, 1, #{title}, #{content}, #{status}, 0, #{fileName}, #{fileSize},
               #{filePath}, #{createdAt}, #{isPinned})
    </insert>

    <update id="noticeUpdate" parameterType="Board">
        UPDATE board
        SET title = #{title}, content = #{content}, status = #{status}
        WHERE id = #{id}
    </update>

    <select id="noticeDetail" resultType="Board" parameterType="int">
        SELECT *
        FROM BOARD
        WHERE id = #{id}
    </select>

    <update id="increaseReadCount" parameterType="Board">
        UPDATE BOARD SET readCount = readCount + 1 WHERE id = #{id}
    </update>

    <delete id="noticeDelete" parameterType="int">
        update board
        where  id = #{id}
    </delete>

    <select id="totalSearchnotice" parameterType="board" resultType="int">
        SELECT count(*)
        FROM  board
        WHERE  boardType = 1
        <if test="searchType == 'title'">
            AND title like '%' || #{keyword} || '%'
        </if>
        <if test="searchType == 'content'">
            AND content like '%' || #{keyword} || '%'
        </if>
        <if test="searchType == 'userId'">
            AND userId like '%' || #{keyword} || '%'
        </if>
    </select>

    <select id="listSearchNotice" parameterType="board"  resultType="board">

        SELECT *
        FROM (
        SELECT ROWNUM RN, C.*
        FROM (
        SELECT A.*
        FROM BOARD A
        WHERE boardType = 1
        <if test="searchType == 'title'">
            AND title like '%' || #{keyword} || '%'
        </if>
        <if test="searchType == 'content'">
            AND content like '%' || #{keyword} || '%'
        </if>
        <if test="searchType == 'userId'">
            AND userId like '%' || #{keyword} || '%'
        </if>
        ORDER BY A.isPinned DESC, A.id DESC
        ) C
        )
        where rn BETWEEN #{start} and #{end}
    </select>

    <select id="QNAboardCount" resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        WHERE boardType = 3
    </select>

    <select id="listQNABoard" resultType="Board">
        SELECT *
        FROM (
                 SELECT ROWNUM RN, C.*
                 FROM (
                          SELECT A.*
                          FROM BOARD A
                          WHERE A.boardType = 3
                          ORDER BY A.id DESC
                      ) C
             )
        where rn between #{start} and #{end}
    </select>

    <insert id="InsertQNABoard" parameterType="Board">
        INSERT INTO Board(id, userId, boardType, title, content, status, readCount, fileName, fileSize, filePath, createdAt)
        VALUES(Board_id_seq.nextval, #{userId}, 3, #{title}, #{content}, #{status}, 0, #{fileName}, #{fileSize},
               #{filePath}, sysdate)
    </insert>

    <update id="QNAUpdate" parameterType="Board">
        UPDATE board
        SET title = #{title}, content = #{content}, status = #{status}
        WHERE id = #{id}
    </update>

    <select id="detailQNA" resultType="Board" parameterType="int">
        SELECT *
        FROM BOARD
        WHERE id = #{id}
    </select>

    <delete id="QNADelete" parameterType="int">
        update board
        where  id = #{id}
    </delete>

    <select id="FAQboardCount" resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        WHERE boardType = 2
    </select>

    <select id="listFAQBoard" resultType="Board">
        SELECT *
        FROM (
                 SELECT ROWNUM RN, C.*
                 FROM (
                          SELECT A.*
                          FROM BOARD A
                          WHERE A.boardType = 2
                          ORDER BY A.id DESC
                      ) C
             )
        where rn between #{start} and #{end}
    </select>

    <insert id="InsertFAQBoard" parameterType="Board">
        INSERT INTO Board(id, userId, boardType, title, content, status, readCount, fileName, fileSize, filePath, createdAt)
        VALUES(Board_id_seq.nextval, #{userId}, 2, #{title}, #{content}, #{status}, 0, #{fileName}, #{fileSize},
               #{filePath}, sysdate)
    </insert>

    <update id="FAQUpdate" parameterType="Board">
        UPDATE board
        SET title = #{title}, content = #{content}, status = #{status}
        WHERE id = #{id}
    </update>

    <select id="detailFAQ" resultType="Board" parameterType="int">
        SELECT *
        FROM BOARD
        WHERE id = #{id}
    </select>

    <delete id="FAQDelete" parameterType="int">
        update board
        where  id = #{id}
    </delete>









</mapper>